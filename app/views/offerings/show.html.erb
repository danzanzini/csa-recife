<p id="notice"><%= notice %></p>

<div class="navbar">
  <div class="h3">
    Detalhes da Oferenda
  </div>

  <div class="float-right">
    <%= link_to 'Editar', edit_offering_path(@offering), class: 'btn btn-secondary btn-md btn-block' %>
    <%= link_to 'Voltar', offerings_path, class: 'btn btn-secondary' %>
  </div>
</div>

<div class="row g-3 pb-3 border-bottom">
  <div class="col-md-4">
    <label for="location_id" class="form-label">Local de Colheita</label>
    <input type="text" readonly class="form-control" id="location_id" value="<%= @offering.location.name %>">
  </div>
  <div class="col-md-4">
    <label for="closes_at" class="form-label">Encerra em</label>
    <input type="text" readonly class="form-control" id="closes_at" value="<%= I18n.l(@offering.closes_at, format: '%d/%m (%A) às %H:%M') %>">
  </div>
  <div class="col-md-4">
    <label for="status" class="form-label">Status</label>
    <input type="text" readonly class="form-control" id="status" value="<%= @offering.status %>">
  </div>
</div>

<div class="h4 mt-3">
  Produtos disponíveis
</div>

<%= form_with(model: [@offering, @offer]) do |form| %>
  <% if @offer.errors.any? %>
    <div id="error_explanation">
      <h2><%= pluralize(@offer.errors.count, "error") %> prohibited this offer from being saved:</h2>

      <ul>
        <% @offer.errors.each do |error| %>
          <li><%= error.full_message %></li>
        <% end %>
      </ul>
    </div>
  <% end %>

  <div class="row mb-3">
    <div class="field col-md-4">
      <%= form.label :product_name, 'Produto', class: 'form-label' %>
      <%= form.text_field :product_name, class: "form-control" %>
    </div>
    <div class="field col-md-4">
      <%= form.label :amount, 'Quantidade', class: 'form-label' %>
      <%= form.text_field :amount, class: "form-control" %>
    </div>

    <div class="col-md-4">
      <%= form.submit 'Adicionar item', class: "btn btn-primary btn-md btn-block" %>
    </div>
  </div>
<% end %>

<table class="table table-striped table-sm text-center">
  <thead>
    <tr>
      <th scope="col">Produto</th>
      <th scope="col">Quantidade</th>
      <th scope="col">Ações</th>
    </tr>
  </thead>

  <tbody>
    <% @offering.offers.order(product_name: :asc).each do |offer| %>
      <tr>
        <th scope="row">
          <%= offer.product_name %>
        </th>
        <td><%= offer.amount %></td>

        <td>
          <%= link_to offering_offer_url(@offering.id, offer.id), method: :delete, data: { confirm: 'Are you sure?' }, class: 'btn btn-danger btn-sm' do %>
            <i class='fas fa-trash fa-sm'></i>
          <% end %>
        </td>
      </tr>
    <% end %>
  </tbody>
</table>
